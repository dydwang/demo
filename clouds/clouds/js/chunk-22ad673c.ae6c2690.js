(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22ad673c"],{"0c80":function(e,t,a){"use strict";var r=a("9ce9"),l=a.n(r);l.a},"1c1a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"create"}},["updates"===e.update?a("el-button",{staticClass:"el-icon-edit",attrs:{round:"",type:"warning"},on:{click:e.confirm}},[e._v(" 修 改")]):a("el-button",{staticClass:"el-icon-plus",attrs:{round:"",type:"primary",disabled:e.createT},on:{click:e.createTable}},[e._v(" 创 建")]),a("el-button",{staticClass:"el-icon-mobile",attrs:{round:"",type:"success"},on:{click:e.preservation}},[e._v(" 保 存 ")]),a("br"),a("br"),a("title-text",{staticStyle:{"margin-bottom":"20px"},attrs:{text:"创建采购计划",weight:"600",color:"#636569"}}),a("plan",{ref:"createPlan",attrs:{plan:e.plan},on:{createList:e.createList}}),a("list",{ref:"createList",attrs:{list:e.list}}),a("mydialog",{ref:"mydialog",attrs:{message:"确认修改物资计划"},on:{dialog:e.updateTable}})],1)},l=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"createForm",staticClass:"demo-ruleForm",staticStyle:{width:"60%"},attrs:{model:e.createForm,rules:e.rules,"label-width":"0"}},[a("el-table",{staticStyle:{width:"98%","min-width":"98%"},attrs:{id:"tabless",data:e.createTable}},[a("el-table-column",{attrs:{label:"计划名称","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入计划名称"},model:{value:e.createForm.procureName,callback:function(t){e.$set(e.createForm,"procureName",t)},expression:"createForm.procureName"}})],1)]}}])}),a("el-table-column",{attrs:{label:"采购时间","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"planMonth"}},[a("el-date-picker",{attrs:{type:"date",format:"yyyy 年 MM 月 dd 日","value-format":"yyyyMMdd",placeholder:"选择日期"},model:{value:e.createForm.procureTime,callback:function(t){e.$set(e.createForm,"procureTime",t)},expression:"createForm.procureTime"}})],1)]}}])}),a("el-table-column",{attrs:{label:"计划类型","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"planType"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.createForm.planType,callback:function(t){e.$set(e.createForm,"planType",t)},expression:"createForm.planType"}},e._l(e.planTypeTable,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]}}])})],1)],1)},i=[],o={name:"plan",props:["plan"],data:function(){return{change:!1,createTable:[{}],createForm:{procureName:"",planType:"",procureTime:""},rules:{procureName:[{required:!0,message:"请输入需求计划名称",trigger:"blur"}],planType:[{required:!0,message:"请选择需求计划类型",trigger:"blur"}],procureTime:[{required:!0,message:"请选择日期",trigger:"blur"}]},options:["财务部","组织部","人事部","策划部","仓库"],person:["李一","小王","Tony","sony"],planTypeTable:[{value:"1",label:"月计划"},{value:"2",label:"年计划"},{value:"3",label:"紧急计划"}]}},methods:{tips:function(){return this.change},submitForm:function(){var e=this;console.log(this.createForm);var t="createForm";this.$refs[t].validate((function(t){if(!t)return e.$message({type:"warning",message:"请完整填写需求计划"}),!1;console.log(e.createForm),e.createPlan()}))},preservation:function(){var e=this,t="createForm";this.$refs[t].validate((function(t){t?(e.$message({type:"success",message:"保存计划成功"}),sessionStorage.setItem("createProcurePlan",JSON.stringify(e.createForm)),e.change=!1):e.$message({type:"warning",message:"请完整填写需求计划"})}))},updateTable:function(){var e=this,t=this.createForm;this.$api.updateProcurePlan(t,(function(a){if(a){var r={create:e.$getName,procureId:t.procureId,createTime:(new Date).getTime()};e.$api.createMaterialPlanState(r,(function(e){}))}}))},createPlan:function(){var e=this,t=this.createForm;t.create=this.$getName(),t.createTime=Date.now(),t.procureId=Date.now(),this.$api.createProcurePlan(t,(function(a){e.$api.createProcurePlanState(t,(function(e){})),e.$emit("createList",t.procureId)}))}},computed:{form:function(){return JSON.parse(JSON.stringify(this.createForm))}},watch:{form:function(){this.change=!0}},mounted:function(){var e=sessionStorage.getItem("createProcurePlan");""!==this.plan&&null!=this.plan?(this.change=!1,this.createForm=this.plan):""!==e&&null!==e&&(this.change=!1,this.createForm=JSON.parse(e))}},s=o,c=a("2877"),u=Object(c["a"])(s,n,i,!1,null,"6c0391ca",null),p=u.exports,d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("metarss",{on:{addList:e.addList}}),a("el-button",{attrs:{type:"danger",round:""}},[e._v("取消合并")]),a("el-popover",{attrs:{placement:"top",width:"500",trigger:"click"}},[a("el-checkbox-group",{on:{change:e.choiceCheckbox},model:{value:e.checkedCities,callback:function(t){e.checkedCities=t},expression:"checkedCities"}},e._l(e.check,(function(t){return a("el-checkbox",{key:t.value,attrs:{label:t.label,value:t.value}},[e._v(e._s(t.label))])})),1),a("el-button",{staticStyle:{"margin-left":"50px"},attrs:{slot:"reference",type:"primary",round:""},slot:"reference"},[e._v("合并")])],1),a("el-table",{staticStyle:{width:"98%"},attrs:{id:"table-column",data:e.tableData}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{attrs:{data:[t.row]}},e._l(e.tableHead2,(function(e,t){return a("el-table-column",{key:e.prpo,attrs:{label:e.label,prop:e.prop}})})),1)]}}])}),a("el-table-column",{attrs:{type:"index",label:"id"}}),e._l(e.tableHead1,(function(e,t){return a("el-table-column",{key:e.prpo,attrs:{label:e.label,prop:e.prop}})})),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"el-icon-delete",staticStyle:{color:"red","font-size":"16px"},attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),e.list.splice(t.$index,1)}}})]}}])})],2)],1)},m=[],h=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{staticClass:"el-icon-circle-plus",staticStyle:{"font-size":"36px",float:"right","margin-right":"5%"},attrs:{type:"text"},on:{click:function(t){e.dialogVisible=!0}}}),a("el-dialog",{attrs:{title:"选择物料纳入采购计划",visible:e.dialogVisible,width:"80%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("title-text",{staticStyle:{"margin-bottom":"20px"},attrs:{text:"物资需求汇总表",weight:"600",color:"#636569"}}),a("el-row",[a("el-col",{attrs:{span:3,offset:14}},[a("el-date-picker",{attrs:{type:"year",format:"yyyy年","value-format":"yyyy",placeholder:"选择年"},on:{change:function(t){e.months=""}},model:{value:e.years,callback:function(t){e.years=t},expression:"years"}})],1),a("el-col",{attrs:{span:3}},[a("el-select",{attrs:{placeholder:"请选择月份",disabled:""===e.years},on:{change:function(t){return e.getList()}},model:{value:e.months,callback:function(t){e.months=t},expression:"months"}},e._l(e.monthTable,(function(t){return a("el-option",{key:t,attrs:{value:t}},[e._v(e._s(t)+"月")])})),1)],1)],1),a("metarialList",{ref:"metarialList",attrs:{list:e.list}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addList}},[e._v("添 加")])],1)],1)],1)},f=[],b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{staticStyle:{width:"98%"},attrs:{id:"table-column",data:e.list}},[a("el-table-column",{attrs:{width:"70"},scopedSlots:e._u([{key:"header",fn:function(t){return[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.checkall},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选 ")])]}},{key:"default",fn:function(t){return[a("el-checkbox",{on:{change:function(t){return e.handleCheckedChange(e.oneCheck)}},model:{value:e.oneCheck[t.$index],callback:function(a){e.$set(e.oneCheck,t.$index,a)},expression:"oneCheck[scope.$index]"}})]}}])}),a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{attrs:{data:[t.row]}},e._l(e.tableHead2,(function(e,t){return a("el-table-column",{key:e.prpo,attrs:{label:e.label,prop:e.prop}})})),1)]}}])}),a("el-table-column",{attrs:{type:"index",label:"id"}}),e._l(e.tableHead1,(function(e,t){return a("el-table-column",{key:e.prpo,attrs:{label:e.label,prop:e.prop}})}))],2)},g=[],y={name:"meterList",props:["list"],data:function(){return{tableHead1:[{label:"物料分类编码",prop:"materialClassificationCode"},{label:"物料分类名称",prop:"materialClassificationName"},{label:"物料编码",prop:"materialCode"},{label:"物料名称",prop:"materialName"},{label:"规格",prop:"specifications"},{label:"型号",prop:"model"},{label:"单位",prop:"company"},{label:"需求数量",prop:"demandQuantity"}],tableHead2:[{label:"需求月份",prop:"demandMonth"},{label:"需求日期",prop:"demandDate"},{label:"货源是否稳定",prop:"source"},{label:"期望供应商",prop:"expectedSupplier"},{label:"固定供应商",prop:"fixedSupplier"},{label:"备注",prop:"remarks"},{label:"物料追踪码 ",prop:"materialTrackingCode"},{label:"需求库存组织",prop:"demandOrganization"}],checkAll:!1,isIndeterminate:!1,oneCheck:[]}},methods:{handleCheckedChange:function(e){this.checkAll=e.every((function(e){return!0===e}));var t=e.filter((function(e){return!0===e}));this.isIndeterminate=t.length>0&&t.length<e.length},checkall:function(e){!0===e&&(this.isIndeterminate=!1);var t=[];this.oneCheck.forEach((function(a,r){t[r]=e})),this.oneCheck=t,console.log(this.oneCheck)},add:function(){var e=this,t=[],a=[];return this.oneCheck.forEach((function(e,a){!0===e&&t.push(a)})),t.forEach((function(t){a.push(e.list[t])})),a}},mounted:function(){},computed:{lis:function(){return JSON.parse(JSON.stringify(this.list))}},watch:{lis:function(){for(var e=0;e<this.list.length;e++)this.oneCheck[e]=!1}}},v=y,k=(a("0c80"),Object(c["a"])(v,b,g,!1,null,null,null)),x=k.exports;function C(e){return w(e)||S(e)||$()}function $(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function S(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function w(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}var T={name:"metar",components:{metarialList:x},data:function(){return{dialogVisible:!1,list:[],years:"",months:"",monthTable:["01","02","03","04","05","06","07","08","09","10","11","12"]}},methods:{getList:function(){var e=this;this.list=[];var t=""===this.months?parseInt(this.years):parseInt(this.years+""+this.months);console.log(t);var a={planState:"2",planMonth:t};this.$api.selectMaterialPlanState(a,(function(a){var r={demandMonth:t};for(var l in a.data)r.planId=a.data[l].planId,e.$api.selectMetarialList(r,(function(t){var a;(a=e.list).push.apply(a,C(t.data))}))}))},addList:function(){this.$emit("addList",this.$refs.metarialList.add()),this.dialogVisible=!1}},created:function(){},watch:{years:function(){this.months="",this.getList()}}},_=T,L=Object(c["a"])(_,h,f,!1,null,"b405e8d6",null),F=L.exports,P=[{label:"物料编码",value:"materialCode"},{label:"需求月份",value:"demandMonth"},{label:"期望供应商",value:"expectedSupplier"},{label:"固定供应商",value:"fixedSupplier"}],I={props:["list"],data:function(){return{check:P,checkedCities:[],tableData:[],change:!1,tableHead1:[{label:"物料编码",prop:"materialCode"},{label:"物料名称",prop:"materialName"},{label:"规格",prop:"specifications"},{label:"单位",prop:"company"},{label:"需求数量",prop:"demandQuantity"},{label:"需求月份",prop:"demandMonth"},{label:"期望供应商",prop:"expectedSupplier"},{label:"固定供应商",prop:"fixedSupplier"}],tableHead2:[{label:"型号",prop:"model"},{label:"物料分类名称",prop:"materialClassificationName"},{label:"物料分类编码",prop:"materialClassificationCode"},{label:"需求日期",prop:"demandDate"},{label:"货源是否稳定",prop:"source"},{label:"备注",prop:"remarks"},{label:"物料追踪码 ",prop:"materialTrackingCode"},{label:"需求库存组织",prop:"demandOrganization"}]}},methods:{preservation:function(){this.change=!1,sessionStorage.setItem("createProcureList",JSON.stringify(this.tableData))},tips:function(){return this.change},addList:function(e){this.tableData=e},choiceCheckbox:function(){console.log(this.checkedCities)},createList:function(e){var t=this;console.log(this.tableData),this.tableData.forEach((function(a){var r={procureId:e,materialTrackingCode:a.materialTrackingCode,materialCode:a.materialCode};t.$api.createProcureList(r,(function(e){}))}))}},components:{metarss:F},mounted:function(){var e=sessionStorage.getItem("createProcureList");""!==this.list&&null!=this.list?(this.change=!1,this.tableData=this.list,console.log(this.list+"list")):""!==e&&null!==e&&(this.change=!1,this.tableData=JSON.parse(e))}},N=I,O=Object(c["a"])(N,d,m,!1,null,"7b516281",null),D=O.exports,M={name:"createProcurePlan",props:["update","list","plan"],components:{plan:p,list:D},data:function(){return{mon:0,createT:!1}},methods:{createTable:function(){this.$refs.createPlan.submitForm(),this.$message({type:"info",message:"二秒后可继续创建"})},updateTable:function(e){!0===e&&this.$refs.createPlan.updateTable()},confirm:function(){this.$refs.mydialog.openDia()},preservation:function(){this.$refs.createPlan.preservation(),this.$refs.createList.preservation()},useCreateList:function(e){this.$refs.createList.createList(e)},getMon:function(e){this.mon=e},createList:function(e){this.$refs.createList.createList(e)}},beforeRouteLeave:function(e,t,a){var r=this.$refs.createList.tips(),l=this.$refs.createPlan.tips();r||l?(this.$message({type:"warning",message:"请保存"}),sessionStorage.setItem("navDefaultActive","2"),this.$store.state.navDefaultActive="2"):a()}},A=M,E=(a("9aa4"),Object(c["a"])(A,r,l,!1,null,"52348682",null));t["default"]=E.exports},"59dd":function(e,t,a){},"9aa4":function(e,t,a){"use strict";var r=a("59dd"),l=a.n(r);l.a},"9ce9":function(e,t,a){}}]);
//# sourceMappingURL=chunk-22ad673c.ae6c2690.js.map