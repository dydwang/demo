(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29dfbf0e"],{"054a":function(e,t,a){},"2a4e":function(e,t,a){"use strict";var r=a("c142"),l=a.n(r);l.a},6158:function(e,t,a){"use strict";var r=a("054a"),l=a.n(r);l.a},"65cf":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"create"}},["updates"===e.update?a("el-button",{staticClass:"el-icon-edit",attrs:{round:"",type:"warning"},on:{click:e.confirm}},[e._v(" 修 改")]):a("el-button",{staticClass:"el-icon-plus",attrs:{round:"",type:"primary",disabled:e.createT},on:{click:e.createTable}},[e._v(" 创 建")]),a("el-button",{staticClass:"el-icon-mobile",attrs:{round:"",type:"success"},on:{click:e.preservation}},[e._v(" 保 存 ")]),a("br"),a("br"),"updates"!==e.update?a("title-text",{staticStyle:{"margin-bottom":"20px"},attrs:{text:"新建物资需求计划",weight:"600",color:"#636569"}}):a("title-text",{staticStyle:{"margin-bottom":"20px"},attrs:{text:"修改物资需求计划",weight:"600",color:"#636569"}}),a("createPlan",{ref:"createPlan",attrs:{plan:e.plan},on:{createPlan:e.useCreateList,mon:e.getMon}}),a("createList",{ref:"createList",attrs:{list:e.list,mon:e.mon}}),a("mydialog",{ref:"mydialog",attrs:{message:"确认修改物资计划"},on:{dialog:e.updateTable}})],1)},l=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"createForm",staticClass:"demo-ruleForm",staticStyle:{width:"100%"},attrs:{model:e.createForm,rules:e.rules,"label-width":"0"}},[a("el-table",{staticStyle:{width:"98%","min-width":"98%"},attrs:{id:"tabless",data:e.createTable}},[a("el-table-column",{attrs:{label:"计划名称","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入计划名称"},model:{value:e.createForm.planName,callback:function(t){e.$set(e.createForm,"planName",t)},expression:"createForm.planName"}})],1)]}}])}),a("el-table-column",{attrs:{label:"需求部门","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.createForm.needDepartment,callback:function(t){e.$set(e.createForm,"needDepartment",t)},expression:"createForm.needDepartment"}},e._l(e.options,(function(e){return a("el-option",{key:e,attrs:{value:e}})})),1)],1)]}}])}),a("el-table-column",{attrs:{label:"需求人","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"needPeoName"}},[a("el-select",{attrs:{disabled:""===e.createForm.needDepartment,placeholder:"请选择"},model:{value:e.createForm.needPeoName,callback:function(t){e.$set(e.createForm,"needPeoName",t)},expression:"createForm.needPeoName"}},e._l(e.person,(function(e){return a("el-option",{key:e,attrs:{value:e}})})),1)],1)]}}])}),a("el-table-column",{attrs:{label:"计划类型","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"planType"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.createForm.planType,callback:function(t){e.$set(e.createForm,"planType",t)},expression:"createForm.planType"}},e._l(e.planTypeTable,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)]}}])}),a("el-table-column",{attrs:{label:"需求计划月份/年","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"planMonth"}},[a("el-date-picker",{attrs:{disabled:""===e.createForm.planType,type:"2"===e.createForm.planType?"year":"month","value-format":"timestamp",placeholder:"选择日期"},on:{change:function(t){return e.getTime(e.createForm.planMonth,e.createForm.planType)}},model:{value:e.createForm.planMonth,callback:function(t){e.$set(e.createForm,"planMonth",t)},expression:"createForm.planMonth"}})],1)]}}])}),a("el-table-column",{attrs:{label:"需求类型","min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form-item",{attrs:{prop:"needType"}},[a("el-select",{attrs:{disabled:""===e.createForm.planType,placeholder:"请选择"},model:{value:e.createForm.needType,callback:function(t){e.$set(e.createForm,"needType",t)},expression:"createForm.needType"}},e._l(e.needTypeTable,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1)],1)]}}])})],1)],1)},i=[],o={name:"createPlan",props:["plan"],data:function(){return{change:!1,createTable:[{}],createForm:{planName:"",planType:"",needDepartment:"",needPeoName:"",planMonth:"",needType:"",planId:"",clickTime:0},rules:{planName:[{required:!0,message:"请输入需求计划名称",trigger:"blur"}],planType:[{required:!0,message:"请选择需求计划类型",trigger:"blur"}],needDepartment:[{required:!0,message:"请选择需求部门",trigger:"blur"}],needPeoName:[{required:!0,message:"请选择需求人",trigger:"blur"}],planMonth:[{required:!0,message:"请选择日期",trigger:"blur"}],needType:[{required:!0,message:"请选择需求类型",trigger:"blur"}]},options:["财务部","组织部","人事部","策划部","仓库"],person:["李一","小王","Tony","sony"],planTypeTable:[{value:"1",label:"月计划"},{value:"2",label:"年计划"},{value:"3",label:"紧急计划"}],needTypeTable:[{value:"1",label:"订单型",disabled:localStorage.getItem("grade")!==this.$constData.grade.produce},{value:"2",label:"非订单型",disabled:localStorage.getItem("grade")!==this.$constData.grade.options},{value:"3",label:"紧急型"}]}},methods:{submitForm:function(){var e=this,t="createForm";this.$refs[t].validate((function(t){if(!t)return e.$message({type:"warning",message:"请完整填写需求计划"}),!1;e.createMaterialPlan()}))},createMaterialPlan:function(){var e=this;this.createForm.planId=(new Date).getTime();var t=JSON.parse(JSON.stringify(this.createForm));t.planMonth=this.createForm.clickTime,this.$api.createMaterialPlan(t,(function(a){if(a){e.$message({type:"success",message:"创建成功"});var r=t.planId;e.$emit("createPlan",r),e.$api.createMaterialPlanChangeState({planId:r},(function(e){}));var l={};l.planId=r,l.createTime=r,l.create=e.$getName(),e.$api.createMaterialPlanState(l,(function(e){}))}}))},tips:function(){return this.change},preservation:function(){var e=this,t="createForm";this.$refs[t].validate((function(t){t?(e.$message({type:"success",message:"保存计划成功"}),sessionStorage.setItem("createForm",JSON.stringify(e.createForm)),e.change=!1):e.$message({type:"warning",message:"请完整填写需求计划"})}))},getTime:function(e,t){var a=new Date(e),r=a.getFullYear(),l=a.getMonth()+1;"2"===t?this.createForm.clickTime=r:1===l.toString().length?this.createForm.clickTime=parseInt(r+"0"+l):this.createForm.clickTime=parseInt(r+""+l),console.log(this.clickTime),this.$emit("mon",this.clickTime)},updateTable:function(){var e=this,t=this.createForm;this.$api.updateMaterialPlan(t,(function(a){if(a){var r={create:e.$getName(),planId:t.planId,createTime:(new Date).getTime()};e.$api.createMaterialPlanState(r,(function(e){}))}}))}},mounted:function(){var e=sessionStorage.getItem("createForm");""!==this.plan&&null!=this.plan?(this.change=!1,this.createForm=this.plan):""!==e&&null!==e&&(this.change=!1,this.createForm=JSON.parse(e))},watch:{createForm:function(e){this.change=!1}}},s=o,c=(a("6158"),a("2877")),m=Object(c["a"])(s,n,i,!1,null,"97b415e0",null),p=m.exports,u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.newTable?a("el-table",{staticStyle:{width:"98%",margin:"30px 0"},attrs:{stripe:"",id:"table-column",data:e.tableData}},[a("el-table-column",{attrs:{type:"index",label:" "}}),a("el-table-column",{attrs:{label:"填写物料清单","header-align":"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t?a("el-table",{staticStyle:{width:"98%"},attrs:{data:[t.row]}},e._l(e.tableHead1,(function(e,t){return a("el-table-column",{key:e.prpo,attrs:{label:e.label,prop:e.prop}})})),1):e._e(),a("el-table",{staticStyle:{width:"98%"},attrs:{data:[t.row]}},e._l(e.tableHead2,(function(e,t){return a("el-table-column",{key:e.prpo,attrs:{label:e.label,prop:e.prop}})})),1)]}}],null,!1,1249016162)}),a("el-table-column",{attrs:{width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"el-icon-edit",attrs:{type:"text"},on:{click:function(a){return e.$refs.listDrawer.updateDrawer(t.row,t.$index)}}}),a("el-button",{staticClass:"el-icon-delete",staticStyle:{color:"red"},attrs:{type:"text"},on:{click:function(a){return e.tableData.splice(t.$index,1)}}})]}}],null,!1,1480277104)})],1):e._e(),a("listDrawer",{ref:"listDrawer",on:{add:e.addTableDate,update:e.updateTableData}}),a("el-button",{staticStyle:{float:"right",margin:"0 5% 50px 0"},attrs:{type:"primary",icon:"el-icon-plus",circle:""},on:{click:function(t){return e.$refs.listDrawer.openDrawer()}}})],1)},d=[],f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"drawerss"}},[a("el-drawer",{attrs:{title:"填写物料清单",visible:e.drawer,direction:e.direction,"before-close":e.handleClose},on:{"update:visible":function(t){e.drawer=t}}},[a("div",{attrs:{id:"formDiv"}},[a("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:e.createForm,rules:e.rules,"label-position":"left","label-width":"110px"}},[a("el-form-item",{attrs:{label:"物料名称",prop:"cascader"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.handleChange},model:{value:e.createForm.cascader,callback:function(t){e.$set(e.createForm,"cascader",t)},expression:"createForm.cascader"}},e._l(e.options,(function(e){return a("el-option",{key:e.materialCode,attrs:{label:e.materialName,value:e.materialCode}})})),1)],1),a("el-form-item",{attrs:{label:"单位",prop:"company"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.createForm.company,callback:function(t){e.$set(e.createForm,"company",t)},expression:"createForm.company"}},e._l(e.coms,(function(e){return a("el-option",{key:e,attrs:{value:e}})})),1)],1),a("el-form-item",{attrs:{label:"需求数量",prop:"demandQuantity"}},[a("el-input-number",{attrs:{step:1},model:{value:e.createForm.demandQuantity,callback:function(t){e.$set(e.createForm,"demandQuantity",t)},expression:"createForm.demandQuantity"}})],1),a("el-form-item",{attrs:{label:"需求日期",prop:"demandDate"}},[a("el-date-picker",{attrs:{type:"date","value-format":"timestamp",placeholder:"选择日期"},on:{change:function(t){return e.clickDate(e.createForm.demandDate)}},model:{value:e.createForm.demandDate,callback:function(t){e.$set(e.createForm,"demandDate",t)},expression:"createForm.demandDate"}})],1),a("el-form-item",{attrs:{label:"货源是否稳定",prop:"source"}},[a("el-radio-group",{model:{value:e.createForm.source,callback:function(t){e.$set(e.createForm,"source",t)},expression:"createForm.source"}},[a("el-radio",{attrs:{label:"是"}},[e._v("是")]),a("el-radio",{attrs:{label:"否"}},[e._v("否")])],1)],1),a("el-form-item",{attrs:{label:"期望供应商",prop:"expectedSupplier"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.createForm.expectedSupplier,callback:function(t){e.$set(e.createForm,"expectedSupplier",t)},expression:"createForm.expectedSupplier"}},[a("el-option",{attrs:{value:"供应商1"}}),a("el-option",{attrs:{value:"供应商2"}}),a("el-option",{attrs:{value:"供应商3"}})],1)],1),a("el-form-item",{attrs:{label:"固定供应商",prop:"fixedSupplier"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.createForm.fixedSupplier,callback:function(t){e.$set(e.createForm,"fixedSupplier",t)},expression:"createForm.fixedSupplier"}},[a("el-option",{attrs:{value:"供应商4"}}),a("el-option",{attrs:{value:"供应商5"}}),a("el-option",{attrs:{value:"供应商6"}})],1)],1),a("el-form-item",{attrs:{label:"需求库存组织",prop:"demandOrganization"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.createForm.demandOrganization,callback:function(t){e.$set(e.createForm,"demandOrganization",t)},expression:"createForm.demandOrganization"}},[a("el-option",{attrs:{value:"组织1"}}),a("el-option",{attrs:{value:"组织2"}}),a("el-option",{attrs:{value:"组织3"}})],1)],1),a("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[a("el-input",{attrs:{maxlength:"30",type:"textarea",placeholder:"请输入内容"},model:{value:e.createForm.remarks,callback:function(t){e.$set(e.createForm,"remarks",t)},expression:"createForm.remarks"}})],1)],1),e.addButton?a("el-button",{staticStyle:{width:"150px",margin:"0 0 50px 50%"},attrs:{type:"primary"},on:{click:e.add}},[e._v("添加")]):a("el-button",{staticStyle:{width:"150px",margin:"0 0 50px 50%"},attrs:{type:"primary"},on:{click:e.update}},[e._v("编辑")])],1)])],1)},h=[],b={name:"listDrawer",data:function(){return{drawer:!1,direction:"rtl",createForm:{materialClassificationCode:"",materialClassificationName:"",materialCode:"",materialName:"",specifications:"",model:"",company:"",demandQuantity:"",demandMonth:"",demandDate:"",source:"",expectedSupplier:"",fixedSupplier:"",remarks:"",materialTrackingCode:"",demandOrganization:"",cascader:""},rules:{cascader:[{required:!0,message:"请选择物品",trigger:"blur"}],company:[{required:!0,message:"请选择物品",trigger:"blur"}],demandQuantity:[{required:!0,message:"请选择物品",trigger:"blur"}],demandDate:[{required:!0,message:"请选择物品",trigger:"blur"}],source:[{required:!0,message:"请选择物品",trigger:"blur"}],expectedSupplier:[{required:!0,message:"请选择物品",trigger:"blur"}],fixedSupplier:[{required:!0,message:"请选择物品",trigger:"blur"}],demandOrganization:[{required:!0,message:"请选择物品",trigger:"blur"}],remarks:[{required:!0,message:"请选择物品",trigger:"blur"}]},addButton:!1,updateButton:!1,options:[],coms:["克","千克","吨","个","张","米","千米"],tableDataId:""}},methods:{submitForm:function(){var e,t=this,a="createForm";return this.$refs[a].validate((function(a){a?(console.log(t.createForm),e=!0):(t.$message({type:"warning",message:"请完整填写需求计划"}),e=!1)})),e},add:function(){this.submitForm()&&(this.$emit("add",this.createForm),this.closeDrawer())},update:function(){this.submitForm()&&(this.$emit("update",this.createForm,this.tableDataId),this.closeDrawer())},openDrawer:function(){this.drawer=!0,this.addButton=!0},closeDrawer:function(){this.drawer=!1,this.addButton=!1,this.updateButton=!1},updateDrawer:function(e,t){this.tableDataId=t,this.drawer=!0,this.updateButton=!0,this.createForm=JSON.parse(JSON.stringify(e))},handleClose:function(e){var t=this;this.$confirm("是否继续填写？").then((function(e){})).catch((function(a){e(),t.closeDrawer()}))},handleChange:function(e){var t;console.log(e),this.options.forEach((function(a){a.materialCode===e&&(t=a)})),console.log(t),this.createForm.materialClassificationCode=t.materialClassificationCode,this.createForm.materialClassificationName=t.materialClassificationName,this.createForm.materialName=t.materialName,this.createForm.materialCode=t.materialCode,this.createForm.specifications=t.specifications,this.createForm.model=t.model,this.createForm.company=t.company},clickDate:function(e){var t=new Date(e);this.createForm.demandMonth=t.getFullYear()+""+parseInt(t.getMonth()+1),console.log(this.createForm.demandMonth)}},created:function(){var e=this;this.$api.getStockList({},(function(t){e.options=t.data}))}},g=b,v=(a("fd33"),Object(c["a"])(g,f,h,!1,null,null,null)),y=v.exports,F={name:"createList",props:["mon","list"],data:function(){return{newTable:!0,change:!1,tableData:[],tableHead1:[{label:"物料分类编码",prop:"materialClassificationCode"},{label:"物料分类名称",prop:"materialClassificationName"},{label:"物料编码",prop:"materialCode"},{label:"物料名称",prop:"materialName"},{label:"型号",prop:"model"},{label:"规格",prop:"specifications"},{label:"单位",prop:"company"},{label:"需求数量",prop:"demandQuantity"}],tableHead2:[{label:"需求月份",prop:"demandMonth"},{label:"需求日期",prop:"demandDate"},{label:"货源是否稳定",prop:"source"},{label:"期望供应商",prop:"expectedSupplier"},{label:"固定供应商",prop:"fixedSupplier"},{label:"需求库存组织",prop:"demandOrganization"},{label:"备注",prop:"remarks"},{label:"",prop:""}]}},methods:{submitForm:function(){var e=this,t="createForm";this.$refs[t].validate((function(t){if(!t)return e.$message({type:"warning",message:"请完整填写需求计划"}),!1;console.log(e.createForm),e.createMaterialPlan()}))},tips:function(){return this.change},preservation:function(){this.change=!1,sessionStorage.setItem("createList",JSON.stringify(this.tableData))},createList:function(e){for(var t in console.log(e),this.tableData){var a=this.tableData[t];a.planId=e,a.materialTrackingCode=e+a.cascader[0]+a.cascader[1],a.cascader=this.tableData[t].cascader.toString(),console.log(a),this.$api.createMetarialList(a,(function(e){}))}},addTableDate:function(e){var t=JSON.parse(JSON.stringify(e));t.demandMonth=this.mon,this.tableData.push(t)},updateTableData:function(e,t){console.log(e,t),this.tableData.splice(t,1),this.tableData.splice(t,0,JSON.parse(JSON.stringify(e))),console.log(this.tableData),this.newTable=!1,this.newTable=!0}},mounted:function(){var e=sessionStorage.getItem("createList");""!==this.list&&null!=this.list?(this.change=!1,this.tableData=this.list,console.log(this.list+"list")):""!==e&&null!==e&&(this.change=!1,this.tableData=JSON.parse(e))},components:{listDrawer:y},watch:{tableData:function(e){this.val==[]&&(console.log(e),this.change=!1)}}},w=F,k=(a("2a4e"),Object(c["a"])(w,u,d,!1,null,null,null)),T=k.exports,D={name:"createMaterial",props:["update","list","plan"],components:{createPlan:p,createList:T},methods:{createTable:function(){var e=this;this.createT=!this.createT,this.$message({type:"info",message:"二秒后可继续创建"}),setTimeout((function(){e.createT=!e.createT}),2e3),this.$refs.createPlan.submitForm()},updateTable:function(e){!0===e&&this.$refs.createPlan.updateTable()},confirm:function(){this.$refs.mydialog.openDia()},preservation:function(){this.$refs.createPlan.preservation(),this.$refs.createList.preservation()},useCreateList:function(e){this.$refs.createList.createList(e)},getMon:function(e){this.mon=e}},data:function(){return{mon:0,createT:!1}},mounted:function(){var e=this;if(this.plan&&""!==this.plan){var t={planId:this.plan.planId};this.$api.getMetarialList(t,(function(t){e.list=t.data}))}},beforeRouteLeave:function(e,t,a){var r=this.$refs.createList.tips(),l=this.$refs.createPlan.tips();r||l?(this.$message({type:"warning",message:"请保存"}),sessionStorage.setItem("navDefaultActive","1"),this.$store.state.navDefaultActive="1"):a()}},$=D,S=(a("92eb"),Object(c["a"])($,r,l,!1,null,"2aae078d",null));t["default"]=S.exports},"92eb":function(e,t,a){"use strict";var r=a("c593"),l=a.n(r);l.a},b81e:function(e,t,a){},c142:function(e,t,a){},c593:function(e,t,a){},fd33:function(e,t,a){"use strict";var r=a("b81e"),l=a.n(r);l.a}}]);
//# sourceMappingURL=chunk-29dfbf0e.594151c0.js.map