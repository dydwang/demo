{"version":3,"sources":["webpack:///./src/views/procureHead/approvalPlan.vue?add6","webpack:///src/views/procureHead/approvalPlan.vue","webpack:///./src/views/procureHead/approvalPlan.vue?7759","webpack:///./src/views/procureHead/approvalPlan.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","model","value","callback","$$v","view","expression","_l","item","key","label","staticStyle","tableData","scopedSlots","_u","fn","scope","isIndeterminate","on","checkall","checkAll","_v","$event","handleCheckedChange","oneCheck","$index","$set","prop","ref","nextPage","open","_e","staticRenderFns","component"],"mappings":"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","file":"js/chunk-2d0e64e4.ff87ea7e.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',[_c('el-select',{attrs:{\"placeholder\":\"分类查看\"},model:{value:(_vm.view),callback:function ($$v) {_vm.view=$$v},expression:\"view\"}},_vm._l((_vm.classifiedView),function(item){return _c('el-option',{key:item.value,attrs:{\"label\":item.label,\"value\":item.value}})}),1)],1),_c('el-table',{staticStyle:{\"width\":\"98%\",\"margin-left\":\"1%\"},attrs:{\"data\":_vm.tableData}},[_c('el-table-column',{scopedSlots:_vm._u([{key:\"header\",fn:function(scope){return [_c('el-checkbox',{attrs:{\"indeterminate\":_vm.isIndeterminate},on:{\"change\":_vm.checkall},model:{value:(_vm.checkAll),callback:function ($$v) {_vm.checkAll=$$v},expression:\"checkAll\"}},[_vm._v(\"全选 \")])]}},{key:\"default\",fn:function(scope){return [_c('el-checkbox',{on:{\"change\":function($event){return _vm.handleCheckedChange(_vm.oneCheck)}},model:{value:(_vm.oneCheck[scope.$index]),callback:function ($$v) {_vm.$set(_vm.oneCheck, scope.$index, $$v)},expression:\"oneCheck[scope.$index]\"}})]}}])}),_vm._l((_vm.tableHead),function(item){return _c('el-table-column',{key:item.prop,attrs:{\"label\":item.label,\"prop\":item.prop}})})],2),_c('nextPage',{ref:\"nextPage\",on:{\"next\":_vm.nextPage}}),_c('br'),_c('br'),_c('br'),(_vm.view===1)?_c('div',{staticStyle:{\"float\":\"right\",\"margin-right\":\"5%\"}},[_c('el-button',{attrs:{\"type\":\"success\",\"disabled\":_vm.oneCheck===[]},on:{\"click\":function($event){return _vm.open('2')}}},[_vm._v(\"审批通过\")]),_c('el-button',{attrs:{\"type\":\"warning\",\"disabled\":_vm.oneCheck===[]},on:{\"click\":function($event){return _vm.open('3')}}},[_vm._v(\"审批退回\")])],1):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <div>\r\n        <div>\r\n            <el-select v-model=\"view\" placeholder=\"分类查看\">\r\n                <el-option\r\n                        v-for=\"item in classifiedView\"\r\n                        :key=\"item.value\"\r\n                        :label=\"item.label\"\r\n                        :value=\"item.value\">\r\n                </el-option>\r\n            </el-select>\r\n        </div>\r\n        <el-table :data=\"tableData\" style=\"width: 98%;margin-left: 1%\">\r\n            <el-table-column>\r\n                <template  slot=\"header\" slot-scope=\"scope\">\r\n                    <el-checkbox\r\n                            :indeterminate=\"isIndeterminate\"\r\n                            @change=\"checkall\"\r\n                            v-model=\"checkAll\">全选\r\n                    </el-checkbox>\r\n                </template>\r\n                <template  slot-scope=\"scope\">\r\n                        <el-checkbox\r\n                                @change=\"handleCheckedChange(oneCheck)\"\r\n                                v-model=\"oneCheck[scope.$index]\">\r\n                        </el-checkbox>\r\n                </template>\r\n            </el-table-column>\r\n            <el-table-column\r\n                    v-for=\"item in tableHead\"\r\n                    :key=\"item.prop\"\r\n                    :label=\"item.label\"\r\n                    :prop=\"item.prop\">\r\n            </el-table-column>\r\n        </el-table>\r\n            <nextPage ref=\"nextPage\" @next=\"nextPage\"></nextPage><br><br><br>\r\n        <div style=\"float:right;margin-right: 5%\" v-if=\"view===1\">\r\n            <el-button type=\"success\"  @click=\"open('2')\" :disabled=\"oneCheck===[]\">审批通过</el-button>\r\n            <el-button type=\"warning\"  @click=\"open('3')\" :disabled=\"oneCheck===[]\">审批退回</el-button>\r\n        </div>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        isIndeterminate: false,\r\n        checkAll: false,//全选\r\n        oneCheck:[],//选了什么\r\n        view:1,\r\n        classifiedView:[    //Classified view分类查看\r\n          { label:'待审批需求计划',value:1 },\r\n          { label:'已审批需求计划',value:2 },\r\n        ],\r\n        tableData:[],\r\n        tableHead:[\r\n          { label:'需求计划编号', prop:'procureId' },\r\n          { label:'需求计划名称', prop:'procureName' },\r\n          { label:'需求计划类型', prop:'planType' },\r\n          { label:'审批状态', prop:'approvalState' },\r\n          { label:'制单人', prop:'create' },\r\n          { label:'制单时间', prop:'createTime' },\r\n         ],\r\n      }\r\n    },\r\n    methods: {\r\n      updateApprovalPlanNeed(cnt){\r\n        this.$api.updateApprovalProcureNeed(cnt,(res)=>{\r\n          if(res.data){\r\n            this.$message({\r\n              type: 'success',\r\n              message: '审批成功 '\r\n            });\r\n          }\r\n        })\r\n      },\r\n      updateApprovalPlanHead(cnt){\r\n        this.$api.updateApprovalProcureHead(cnt,(res)=>{\r\n          console.log(res)\r\n          if(res.data){\r\n            this.$message({\r\n              type: 'success',\r\n              message: '审批成功 '\r\n            });\r\n          }\r\n\r\n        })\r\n      },\r\n      open(state) {\r\n        let arr=[]\r\n        this.oneCheck.forEach((val,id)=>{\r\n            if(val===true) arr.push(id)\r\n        })\r\n        console.log(arr)\r\n        this.$prompt('请在下方填写','审批意见', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n        }).then((remarks) => {\r\n          arr.forEach((item)=>{\r\n            if(state==='3'){\r\n              let s={\r\n                planId:this.tableData[item].planId,\r\n                approvalState:'3',\r\n                planState:'4'\r\n              }\r\n              this.$api.changeState(s,(res)=>{\r\n              })\r\n            }\r\n              let cnt={\r\n                procureId:this.tableData[item].procureId,\r\n                approvalState:localStorage.getItem('grade') === this.$constData.grade.finance?(state==='2'?'2':'3'):(state==='2'?'4':'3')\r\n              }\r\n              if(localStorage.getItem('grade') === this.$constData.grade.finance){//需求计划员审核\r\n                cnt.approvalNeed=\"需求计划员\"\r\n                cnt.approvalNeedTime=Date.now()\r\n                cnt.approvalNeedRemarks=remarks.value\r\n                cnt.needState=state\r\n                this.updateApprovalPlanNeed(cnt)\r\n              }else{\r\n                cnt.approvalHead=\"部门主管\"\r\n                cnt.approvalHeadTime=Date.now()\r\n                cnt.approvalHeadRemarks=remarks.value\r\n                cnt.headState=state\r\n                this.updateApprovalPlanHead(cnt)////主管审核\r\n              }\r\n          })\r\n        }).catch(() => {\r\n          this.$message({\r\n            type: 'info',\r\n            message: '取消审批'\r\n          });\r\n        });\r\n      },\r\n      handleCheckedChange(value) {\r\n        this.checkAll = value.every((val)=>{ //遍历全选情况，判断是否已经全选\r\n          return val===true\r\n        })\r\n\r\n        //如果至少选择一个不全选，出现一横情况\r\n        let checkNum=value.filter((val)=>{\r\n            return val===true\r\n        })\r\n        this.isIndeterminate =  checkNum.length>0&&checkNum.length<value.length\r\n      },\r\n      checkall(value){\r\n        if(value===true) this.isIndeterminate=false\r\n        //点击全选\r\n        let arr=[]\r\n        this.oneCheck.forEach((val,id)=>{\r\n          arr[id]=value\r\n        })\r\n        this.oneCheck=arr\r\n        console.log(this.oneCheck)\r\n      },\r\n      nextPage(cnt){\r\n        cnt.headState=localStorage.getItem('grade') === this.$constData.grade.finance?'2':(this.view===1?'is null':'is not null')\r\n        cnt.approvalState='4'\r\n        cnt.needState=localStorage.getItem('grade') === this.$constData.grade.finance?(this.view===1?'is null':'is not null'):''\r\n        this.getApprovalPlan(cnt)\r\n      },\r\n      getApprovalProcure(cnt){\r\n        this.$api.getApprovalProcure(cnt,(res)=>{\r\n          this.tableData=res.data\r\n          this.$refs.nextPage.judge(res.data.length)\r\n          for(let i=0;i<res.data.length;i++){\r\n            this.oneCheck[i]=false\r\n          }\r\n        })\r\n      }\r\n    },\r\n    mounted() {\r\n      let cnt={\r\n        offset:0,\r\n        count:10,\r\n        headState:localStorage.getItem('grade') === this.$constData.grade.finance?'2':(this.view===1?'is null':'is not null'),\r\n        approvalState:'4',\r\n        needState:localStorage.getItem('grade') === this.$constData.grade.finance?(this.view===1?'is null':'is not null'):'',\r\n      }\r\n      this.getApprovalProcure(cnt)\r\n    },\r\n    watch:{\r\n      view(){\r\n        let cnt={\r\n          offset:0,\r\n          count:10,\r\n          headState:localStorage.getItem('grade') === this.$constData.grade.finance?\"2\":(this.view===1?'is null':'is not null'),\r\n          approvalState:'4',\r\n          needState:localStorage.getItem('grade') === this.$constData.grade.finance?(this.view===1?'is null':'is not null'):'',\r\n        }\r\n        this.getApprovalProcure(cnt)\r\n      }\r\n    }\r\n  }\r\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./approvalPlan.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./approvalPlan.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./approvalPlan.vue?vue&type=template&id=7a35efa2&\"\nimport script from \"./approvalPlan.vue?vue&type=script&lang=js&\"\nexport * from \"./approvalPlan.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}