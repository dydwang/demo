(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e64e4"],{"97d4":function(e,a,t){"use strict";t.r(a);var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("div",[t("el-select",{attrs:{placeholder:"分类查看"},model:{value:e.view,callback:function(a){e.view=a},expression:"view"}},e._l(e.classifiedView,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-table",{staticStyle:{width:"98%","margin-left":"1%"},attrs:{data:e.tableData}},[t("el-table-column",{scopedSlots:e._u([{key:"header",fn:function(a){return[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.checkall},model:{value:e.checkAll,callback:function(a){e.checkAll=a},expression:"checkAll"}},[e._v("全选 ")])]}},{key:"default",fn:function(a){return[t("el-checkbox",{on:{change:function(a){return e.handleCheckedChange(e.oneCheck)}},model:{value:e.oneCheck[a.$index],callback:function(t){e.$set(e.oneCheck,a.$index,t)},expression:"oneCheck[scope.$index]"}})]}}])}),e._l(e.tableHead,(function(e){return t("el-table-column",{key:e.prop,attrs:{label:e.label,prop:e.prop}})}))],2),t("nextPage",{ref:"nextPage",on:{next:e.nextPage}}),t("br"),t("br"),t("br"),1===e.view?t("div",{staticStyle:{float:"right","margin-right":"5%"}},[t("el-button",{attrs:{type:"success",disabled:e.oneCheck===[]},on:{click:function(a){return e.open("2")}}},[e._v("审批通过")]),t("el-button",{attrs:{type:"warning",disabled:e.oneCheck===[]},on:{click:function(a){return e.open("3")}}},[e._v("审批退回")])],1):e._e()],1)},l=[],o={data:function(){return{isIndeterminate:!1,checkAll:!1,oneCheck:[],view:1,classifiedView:[{label:"待审批需求计划",value:1},{label:"已审批需求计划",value:2}],tableData:[],tableHead:[{label:"需求计划编号",prop:"procureId"},{label:"需求计划名称",prop:"procureName"},{label:"需求计划类型",prop:"planType"},{label:"审批状态",prop:"approvalState"},{label:"制单人",prop:"create"},{label:"制单时间",prop:"createTime"}]}},methods:{updateApprovalPlanNeed:function(e){var a=this;this.$api.updateApprovalProcureNeed(e,(function(e){e.data&&a.$message({type:"success",message:"审批成功 "})}))},updateApprovalPlanHead:function(e){var a=this;this.$api.updateApprovalProcureHead(e,(function(e){console.log(e),e.data&&a.$message({type:"success",message:"审批成功 "})}))},open:function(e){var a=this,t=[];this.oneCheck.forEach((function(e,a){!0===e&&t.push(a)})),console.log(t),this.$prompt("请在下方填写","审批意见",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(n){t.forEach((function(t){if("3"===e){var l={planId:a.tableData[t].planId,approvalState:"3",planState:"4"};a.$api.changeState(l,(function(e){}))}var o={procureId:a.tableData[t].procureId,approvalState:localStorage.getItem("grade")===a.$constData.grade.finance?"2"===e?"2":"3":"2"===e?"4":"3"};localStorage.getItem("grade")===a.$constData.grade.finance?(o.approvalNeed="需求计划员",o.approvalNeedTime=Date.now(),o.approvalNeedRemarks=n.value,o.needState=e,a.updateApprovalPlanNeed(o)):(o.approvalHead="部门主管",o.approvalHeadTime=Date.now(),o.approvalHeadRemarks=n.value,o.headState=e,a.updateApprovalPlanHead(o))}))})).catch((function(){a.$message({type:"info",message:"取消审批"})}))},handleCheckedChange:function(e){this.checkAll=e.every((function(e){return!0===e}));var a=e.filter((function(e){return!0===e}));this.isIndeterminate=a.length>0&&a.length<e.length},checkall:function(e){!0===e&&(this.isIndeterminate=!1);var a=[];this.oneCheck.forEach((function(t,n){a[n]=e})),this.oneCheck=a,console.log(this.oneCheck)},nextPage:function(e){e.headState=localStorage.getItem("grade")===this.$constData.grade.finance?"2":1===this.view?"is null":"is not null",e.approvalState="4",e.needState=localStorage.getItem("grade")===this.$constData.grade.finance?1===this.view?"is null":"is not null":"",this.getApprovalPlan(e)},getApprovalProcure:function(e){var a=this;this.$api.getApprovalProcure(e,(function(e){a.tableData=e.data,a.$refs.nextPage.judge(e.data.length);for(var t=0;t<e.data.length;t++)a.oneCheck[t]=!1}))}},mounted:function(){var e={offset:0,count:10,headState:localStorage.getItem("grade")===this.$constData.grade.finance?"2":1===this.view?"is null":"is not null",approvalState:"4",needState:localStorage.getItem("grade")===this.$constData.grade.finance?1===this.view?"is null":"is not null":""};this.getApprovalProcure(e)},watch:{view:function(){var e={offset:0,count:10,headState:localStorage.getItem("grade")===this.$constData.grade.finance?"2":1===this.view?"is null":"is not null",approvalState:"4",needState:localStorage.getItem("grade")===this.$constData.grade.finance?1===this.view?"is null":"is not null":""};this.getApprovalProcure(e)}}},r=o,c=t("2877"),i=Object(c["a"])(r,n,l,!1,null,null,null);a["default"]=i.exports}}]);
//# sourceMappingURL=chunk-2d0e64e4.ff87ea7e.js.map