(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1bd0ae08"],{"026d":function(e,t,r){"use strict";var i=r("74e5"),s=r.n(i);s.a},"1d0e":function(e,t,r){"use strict";var i=r("e34e"),s=r.n(i);s.a},"74e5":function(e,t,r){},"9d55":function(e,t,r){"use strict";var i=r("fe83"),s=r.n(i);s.a},b0c0:function(e,t,r){var i=r("83ab"),s=r("9bf2").f,a=Function.prototype,o=a.toString,n=/^\s*function ([^ (]*)/,c="name";!i||c in a||s(a,c,{configurable:!0,get:function(){try{return o.call(this).match(n)[1]}catch(e){return""}}})},d806:function(e,t,r){"use strict";var i=r("e211"),s=r.n(i);s.a},e1ec:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"create"}},[r("el-steps",{attrs:{active:e.active,"align-center":"","finish-status":"success"}},[r("el-step",{attrs:{description:"创建课程"}}),r("el-step",{attrs:{description:"创建章节"}}),r("el-step",{attrs:{description:"上传视频"}})],1),r("first",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active===0"}],ref:"first"}),r("second",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active===1"}],ref:"second",on:{videoList:e.videoList}}),e.list!==[]&&2===e.active?r("third",{ref:"third",attrs:{list:e.list,courseId:e.courseId,tableData:e.tableData}}):e._e(),r("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active===1"}],on:{click:function(t){return e.backStep()}}},[e._v("上一步")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active===0"}],attrs:{type:"primary"},on:{click:function(t){return e.nextStep()}}},[e._v("下一步")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active===1"}],attrs:{type:"primary"},on:{click:function(t){return e.createStep()}}},[e._v("创建")])],1)},s=[],a=(r("0d03"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"box"}},[r("el-form",{ref:"ruleFormFirst",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-position":"left","label-width":"80px"}},[r("el-form-item",{attrs:{label:"课程名称",prop:"courseName"}},[r("el-input",{model:{value:e.ruleForm.courseName,callback:function(t){e.$set(e.ruleForm,"courseName",t)},expression:"ruleForm.courseName"}})],1),r("el-form-item",{attrs:{label:"课程介绍",prop:"courseIntroduce"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.courseIntroduce,callback:function(t){e.$set(e.ruleForm,"courseIntroduce",t)},expression:"ruleForm.courseIntroduce"}})],1),r("el-form-item",{attrs:{label:"课程图片",prop:"imageName"}},[r("up-img",{ref:"upImg",on:{success:e.getImgPath,changeImg:e.changeImg}})],1),r("el-form-item",{attrs:{label:"课程费用",prop:"courseCharge"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"免费","inactive-text":"收费"},model:{value:e.ruleForm.courseCharge,callback:function(t){e.$set(e.ruleForm,"courseCharge",t)},expression:"ruleForm.courseCharge"}}),r("br")],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.ruleForm.courseCharge,expression:"!ruleForm.courseCharge"}],attrs:{label:"价格",prop:"courseCharge"}},[r("el-input-number",{directives:[{name:"show",rawName:"v-show",value:!e.ruleForm.courseCharge,expression:"!ruleForm.courseCharge"}],attrs:{min:0},model:{value:e.ruleForm.coursePrice,callback:function(t){e.$set(e.ruleForm,"coursePrice",t)},expression:"ruleForm.coursePrice"}}),e._v("元 ")],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.ruleForm.courseCharge,expression:"!ruleForm.courseCharge"}],attrs:{label:"免费节数",prop:"courseCharge"}},[r("el-input-number",{attrs:{min:1,max:6,step:1,"step-strictly":!0},model:{value:e.ruleForm.freeNode,callback:function(t){e.$set(e.ruleForm,"freeNode",t)},expression:"ruleForm.freeNode"}}),e._v("节 ")],1)],1)],1)}),o=[],n=(r("b0c0"),{name:"first",props:[""],data:function(){return{ruleForm:{courseName:"",imagePath:"",imageName:"",imageSize:"",courseIntroduce:"",courseCharge:!0,coursePrice:0,freeNode:!0===this.getCourseCharge?0:1,getCourseCharge:function(){return this.courseCharge},create:this.$userInfo.openId,courseId:0},rules:{courseName:[{required:!0,message:"请输入课程名称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 ",trigger:"blur"}],imageName:[{required:!0,message:"请选择课程图片",trigger:"blur"}],courseIntroduce:[{required:!0,message:"请输入课程介绍",trigger:"blur"},{min:3,max:50,message:"长度在 3 到 50 ",trigger:"blur"}],courseCharge:[{required:!0,message:"请选择是否收费",trigger:"blur"}]}}},methods:{submitForm:function(){var e,t=this;return this.$refs.ruleFormFirst.validate((function(r){r?e=!0:(t.$message.error("请填写完整"),e=!1)})),e},submitImg:function(){this.$refs.upImg.submit()},getImgPath:function(e){this.ruleForm.imagePath=e,this.course()},changeImg:function(e){this.ruleForm.imageName=e.name,this.ruleForm.imageSize=e.size},createCourse:function(e){this.ruleForm.courseId=e,this.$refs.upImg.submit()},course:function(){this.ruleForm.courseCharge+="",this.$api.createCourse(this.ruleForm,(function(e){}))}},mounted:function(){},create:function(){}}),c=n,u=(r("1d0e"),r("2877")),l=Object(u["a"])(c,a,o,!1,null,"26d8f99d",null),d=l.exports,m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"second"}},e._l(e.tableData,(function(t,i){return r("div",{key:i},[r("el-form",{ref:"ruleFormSecond",refInFor:!0,staticClass:"demo-ruleForm",attrs:{model:t.chapter,rules:e.rules,inline:!0,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"第"+(i+1)+"章名称",prop:"chapterName"}},[r("el-input",{model:{value:t.chapter.chapterName,callback:function(r){e.$set(t.chapter,"chapterName",r)},expression:"item.chapter.chapterName"}})],1),r("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary",size:"mini",circle:""},on:{click:function(t){e.tableData.splice(i+1,0,JSON.parse(JSON.stringify(e.fixed)))}}}),r("el-button",{staticClass:"el-icon-minus",attrs:{type:"danger",size:"mini",disabled:1===e.tableData.length,circle:""},on:{click:function(t){return e.tableData.splice(i,1)}}}),e._l(t.section,(function(s,a){return r("el-form",{key:a,ref:"ruleFormChild",refInFor:!0,staticClass:"demo-ruleForm",attrs:{model:s,rules:e.rules,inline:!0,"label-width":"100px"}},[r("el-table",{staticStyle:{width:"auto","margin-left":"40px"},attrs:{"show-header":0===a,data:[t.section[a]]}},[r("el-table-column",{attrs:{width:"80",type:"index"}},[e._v(" "+e._s(i+1)+"-"+e._s(a+1)+" ")]),r("el-table-column",{attrs:{prop:"sectionName",label:"小节名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",{attrs:{prop:"sectionName"}},[r("el-input",{model:{value:s.sectionName,callback:function(t){e.$set(s,"sectionName",t)},expression:"it.sectionName"}})],1)]}}],null,!0)}),r("el-table-column",{attrs:{prop:"date",label:"选择视频"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",{attrs:{prop:"videoSize"}},[r("upVideo",{ref:"upVideo",refInFor:!0,attrs:{videoName:s.videoName,index:i,id:a},on:{success:e.getVideoPath,changeVideo:e.changeVideo}})],1)]}}],null,!0)}),r("el-table-column",{attrs:{prop:"date",width:"90",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(i){return[r("el-button",{staticClass:"el-icon-plus",staticStyle:{color:"blue"},attrs:{type:"text",size:"mini",circle:""},on:{click:function(r){t.section.splice(a+1,0,JSON.parse(JSON.stringify(e.fixed.section[0])))}}}),r("el-button",{staticClass:"el-icon-minus",staticStyle:{color:"red"},attrs:{type:"text",size:"mini",disabled:1===t.section.length,circle:""},on:{click:function(e){return t.section.splice(a,1)}}})]}}],null,!0)})],1)],1)}))],2)],1)})),0)},h=[],p=(r("4160"),r("159b"),{name:"second",props:[""],data:function(){return{tableData:[{chapter:{chapterName:"123",chapterLabel:"",chapterId:"",courseId:""},section:[{sectionId:"123",sectionName:"123",videoPath:"",videoSize:"",videoName:"",sectionLabel:"",courseId:"",chapterId:""}]}],fixed:{chapter:{chapterName:"123",chapterLabel:"",chapterId:"",courseId:""},section:[{sectionId:"",sectionName:"123",videoPath:"",videoSize:"",videoName:"",sectionLabel:"",courseId:"",chapterId:""}]},rules:{chapterName:[{required:!0,message:"请输入章名称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 ",trigger:"blur"}],sectionName:[{required:!0,message:"请输入小节称",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 ",trigger:"blur"}],videoSize:[{required:!0,message:"请选择视频",trigger:"blur"}]},videoList:{}}},methods:{getVideoPath:function(e,t,r){this.tableData[t].section[r].videoPath=e},changeVideo:function(e,t,r,i){this.tableData[r].section[i].videoSize=e.size,this.tableData[r].section[i].sectionLabel=r+"-"+i,this.tableData[r].section[i].videoName=e.name,this.tableData[r].chapter.chapterLabel=r,e.index=r,e.id=i;var s=10+r+"-"+(10+i);this.videoList[s]=e},submitForm:function(){var e=!0;return this.$refs.ruleFormSecond.forEach((function(t){t.validate((function(t){t||(e=!1)}))})),this.$refs.ruleFormChild.forEach((function(t){t.validate((function(t){t||(e=!1)}))})),e?this.$emit("videoList",this.videoList,this.tableData):this.$message.error("请填写完整"),e},submitVideo:function(){this.$refs.upVideo.forEach((function(e){e.submit()}))}},mounted:function(){},create:function(){}}),f=p,b=(r("026d"),Object(u["a"])(f,m,h,!1,null,"875199b2",null)),v=b.exports,g=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"box"}},e._l(e.list,(function(t,i){return r("div",{key:i},[r("el-upload",{ref:"upload",refInFor:!0,staticClass:"avatar-uploader",attrs:{action:e.nodeUrl,"show-file-list":!0,"auto-upload":!0,"on-success":e.success,"before-upload":e.beforeAvatarUpload,"list-type":"picture",disabled:!0,"file-list":[t]}},[r("i",{staticClass:"el-icon-folder-opened  el-upload__tip",staticStyle:{"font-size":"50px","margin-left":"20px",position:"relative",top:"80px","z-index":"100"}})])],1)})),0)},I=[],x={props:["list","tableData","courseId"],data:function(){return{uploadId:0,message:"",uploadSuccess:!1,nodeUrl:this.$nodeUrl+"video/createVideo"}},methods:{submit:function(e){this.$refs.upload[this.uploadId].submit()},success:function(e,t,r){this.tableData[t.index].section[t.id].videoPath=e,this.createSection(t.index,t.id),this.list.length-1>this.uploadId?this.submit(this.uploadId++):(this.createChapter(),this.uploadSuccess=!0)},beforeAvatarUpload:function(e){return!0},createSection:function(e,t){var r=this.tableData[e].section[t];r.courseId=this.courseId,r.chapterId=this.courseId+""+(100+e),r.sectionId=this.courseId+""+(100+e)+(100+t),console.log(this.courseId+""+(100+e)+(100+t)),console.log(r),this.$api.createSection(r,(function(e){}))},createChapter:function(){var e=this;this.tableData.forEach((function(t,r){var i=t.chapter;i.courseId=e.courseId,i.chapterId=e.courseId+""+(100+r),e.$api.createChapter(i,(function(e){}))}))}},mounted:function(){this.submit(0),this.message=this.$message({type:"warning",message:"请上传成功前不要关闭页面",duration:0})},watch:{uploadSuccess:function(){this.message.close()}},beforeRouteLeave:function(e,t,r){this.uploadSuccess?(this.message.close(),r()):this.$notify({title:"警告",message:"还未上传完成",type:"warning"})}},F=x,w=(r("d806"),Object(u["a"])(F,g,I,!1,null,"79bfca88",null)),N=w.exports,$={name:"upload",components:{first:d,second:v,third:N},data:function(){return{active:0,list:[],tableData:[],courseId:Date.now()+"",status:""}},methods:{backStep:function(){this.active--},nextStep:function(){this.$refs.first.submitForm()&&this.active++},createStep:function(){this.$refs.second.submitForm()},videoList:function(e,t){var r=[],i=[];for(var s in e)r.push(s);for(var a=0,o=r;a<o.length;a++){var n=o[a];i.push(e[n])}this.$refs.first.createCourse(this.courseId),this.list=i,this.tableData=t,this.active++},backView:function(){this.$router.push("/grade"),this.$message("没有权限，请申请"),this.$resetSetItem("leftMenu","4")}},created:function(){var e=this;this.$api.getGrade({openId:this.$userInfo.openId},(function(t){t&&"1"!==t[0].grade&&e.backView()}));var t={openId:this.$userInfo.openId};this.$api.getTeacher(t,(function(t){"2"!==t[0].status&&e.backView()}))}},C=$,S=(r("9d55"),Object(u["a"])(C,i,s,!1,null,"d0b93ed8",null));t["default"]=S.exports},e211:function(e,t,r){},e34e:function(e,t,r){},fe83:function(e,t,r){}}]);
//# sourceMappingURL=chunk-1bd0ae08.5f03059b.js.map