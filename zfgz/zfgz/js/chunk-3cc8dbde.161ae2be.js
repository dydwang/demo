(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3cc8dbde"],{"06d4":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"box"}},[e.change?r("upload",{attrs:{courseList:e.courseList}}):r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[r("el-table-column",{attrs:{prop:"imagePath"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("user-image",{attrs:{width:"60px",height:"60px",src:e.row.imagePath}})]}}],null,!1,3183535203)}),r("el-table-column",{attrs:{prop:"courseName",label:"名称"}}),r("el-table-column",{attrs:{prop:"clickNum",label:"热度"}}),r("el-table-column",{attrs:{prop:"courseId",label:"上传时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$allFun.getTime(t.row.courseId))+" ")]}}],null,!1,1738842809)}),!0===e.admin?r("el-table-column",{attrs:{prop:"clickNum",label:new Date(Date.now()).getHours()+":"+(parseInt(3*(new Date(Date.now()).getMinutes()/3).toFixed(0))+2)+"过期"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.cryptoJs(t.row.courseId))+" ")]}}],null,!1,2447659702)}):e._e(),r("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{type:"text",size:"small"},on:{click:function(r){return e.updateCourse(t)}}},[e._v("修改")]),r("el-button",{staticStyle:{color:"red"},attrs:{type:"text",size:"small"},on:{click:function(r){return e.deleteCourse(t)}}},[e._v("删除")])]}}],null,!1,2431077508)})],1)],1)},i=[],s=(r("a434"),r("0d03"),r("b680"),r("e25e"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"create"}},[r("el-steps",{attrs:{active:e.active,"align-center":"","finish-status":"success"}},[r("el-step",{attrs:{description:"创建课程"}}),r("el-step",{attrs:{description:"创建章节"}}),r("el-step",{attrs:{description:"上传视频"}})],1),r("first",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active===0"}],ref:"first",attrs:{courseList:e.courseList}}),1===e.active?r("second",{ref:"second",attrs:{tableData:e.tableData},on:{videoList:e.videoList}}):e._e(),e.list!==[]&&2===e.active?r("third",{ref:"third",attrs:{list:e.list,courseId:e.courseId,tableData:e.tableData}}):e._e(),r("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active===1"}],on:{click:function(t){return e.backStep()}}},[e._v("上一步")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active===0"}],attrs:{type:"primary"},on:{click:function(t){return e.nextStep()}}},[e._v("下一步")]),r("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active===1"}],attrs:{type:"primary"},on:{click:function(t){return e.createStep()}}},[e._v("创建")])],1)}),o=[],n=(r("4de4"),r("4160"),r("ac1f"),r("1276"),r("159b"),function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"box"}},[r("el-form",{ref:"ruleFormFirst",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-position":"left","label-width":"80px"}},[r("el-form-item",{attrs:{label:"课程图片"}},[r("user-image",{attrs:{width:"80px",height:"80px",src:e.ruleForm.imagePath}})],1),r("el-form-item",{attrs:{label:"课程名称",prop:"courseName"}},[r("el-input",{model:{value:e.ruleForm.courseName,callback:function(t){e.$set(e.ruleForm,"courseName",t)},expression:"ruleForm.courseName"}})],1),r("el-form-item",{attrs:{label:"课程介绍",prop:"courseIntroduce"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.courseIntroduce,callback:function(t){e.$set(e.ruleForm,"courseIntroduce",t)},expression:"ruleForm.courseIntroduce"}})],1),r("el-form-item",{attrs:{label:"课程费用",prop:"courseCharge"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"免费","inactive-text":"收费"},model:{value:e.ruleForm.courseCharge,callback:function(t){e.$set(e.ruleForm,"courseCharge",t)},expression:"ruleForm.courseCharge"}}),r("br")],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.ruleForm.courseCharge,expression:"!ruleForm.courseCharge"}],attrs:{label:"价格",prop:"courseCharge"}},[r("el-input-number",{directives:[{name:"show",rawName:"v-show",value:!e.ruleForm.courseCharge,expression:"!ruleForm.courseCharge"}],attrs:{min:0},model:{value:e.ruleForm.coursePrice,callback:function(t){e.$set(e.ruleForm,"coursePrice",t)},expression:"ruleForm.coursePrice"}}),e._v("元 ")],1),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.ruleForm.courseCharge,expression:"!ruleForm.courseCharge"}],attrs:{label:"免费节数",prop:"courseCharge"}},[r("el-input-number",{attrs:{min:1,max:6,step:1,"step-strictly":!0},model:{value:e.ruleForm.freeNode,callback:function(t){e.$set(e.ruleForm,"freeNode",t)},expression:"ruleForm.freeNode"}}),e._v("节 ")],1)],1)],1)}),c=[],u=(r("b0c0"),{name:"first",props:["courseList"],data:function(){return{ruleForm:this.courseList,rules:{courseName:[{required:!0,message:"请输入课程名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 ",trigger:"blur"}],imageName:[{required:!0,message:"请选择课程图片",trigger:"blur"}],courseIntroduce:[{required:!0,message:"请输入课程介绍",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 ",trigger:"blur"}],courseCharge:[{required:!0,message:"请选择是否收费",trigger:"blur"}]}}},methods:{submitForm:function(){var e,t=this;return this.$refs.ruleFormFirst.validate((function(r){r?e=!0:(t.$message.error("请填写完整"),e=!1)})),e},submitImg:function(){this.$refs.upImg.submit()},getImgPath:function(e){this.ruleForm.imagePath=e,this.course()},changeImg:function(e){this.ruleForm.imageName=e.name,this.ruleForm.imageSize=e.size},createCourse:function(e){this.ruleForm.courseId=e,this.course()},course:function(){this.ruleForm.courseCharge+="",this.$api.createCourse(this.ruleForm,(function(e){}))}},mounted:function(){},created:function(){this.ruleForm.courseCharge="true"===this.ruleForm.courseCharge}}),l=u,d=(r("7b07"),r("2877")),m=Object(d["a"])(l,n,c,!1,null,"22061002",null),h=m.exports,f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"second"}},e._l(e.tableData,(function(t,a){return r("div",{key:a},[r("el-form",{ref:"ruleFormSecond",refInFor:!0,staticClass:"demo-ruleForm",attrs:{model:t.chapter,rules:e.rules,inline:!0,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"第"+(a+1)+"章名称",prop:"chapterName"}},[r("el-input",{model:{value:t.chapter.chapterName,callback:function(r){e.$set(t.chapter,"chapterName",r)},expression:"item.chapter.chapterName"}})],1),r("el-button",{staticClass:"el-icon-plus",attrs:{type:"primary",size:"mini",circle:""},on:{click:function(t){e.tableData.splice(a+1,0,JSON.parse(JSON.stringify(e.fixed)))}}}),r("el-button",{staticClass:"el-icon-minus",attrs:{type:"danger",size:"mini",disabled:1===e.tableData.length,circle:""},on:{click:function(t){return e.tableData.splice(a,1)}}}),e._l(t.section,(function(i,s){return r("el-form",{key:s,ref:"ruleFormChild",refInFor:!0,staticClass:"demo-ruleForm",attrs:{model:i,rules:e.rules,inline:!0,"label-width":"100px"}},[r("el-table",{staticStyle:{width:"auto","margin-left":"40px"},attrs:{"show-header":0===s,data:[t.section[s]]}},[r("el-table-column",{attrs:{width:"80",type:"index"}},[e._v(" "+e._s(a+1)+"-"+e._s(s+1)+" ")]),r("el-table-column",{attrs:{prop:"sectionName",label:"小节名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",{attrs:{prop:"sectionName"}},[r("el-input",{model:{value:i.sectionName,callback:function(t){e.$set(i,"sectionName",t)},expression:"it.sectionName"}})],1)]}}],null,!0)}),r("el-table-column",{attrs:{prop:"date",label:"选择视频"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-form-item",{attrs:{prop:"videoSize"}},[t.row.videoPath?r("div",[e._v("已有视频")]):r("upVideo",{ref:"upVideo",refInFor:!0,attrs:{videoName:i.videoName,index:a,id:s},on:{success:e.getVideoPath,changeVideo:e.changeVideo}})],1)]}}],null,!0)}),r("el-table-column",{attrs:{prop:"date",width:"90",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(a){return[r("el-button",{staticClass:"el-icon-plus",staticStyle:{color:"blue"},attrs:{type:"text",size:"mini",circle:""},on:{click:function(r){t.section.splice(s+1,0,JSON.parse(JSON.stringify(e.fixed.section[0])))}}}),r("el-button",{staticClass:"el-icon-minus",staticStyle:{color:"red"},attrs:{type:"text",size:"mini",disabled:1===t.section.length,circle:""},on:{click:function(e){return t.section.splice(s,1)}}})]}}],null,!0)})],1)],1)}))],2)],1)})),0)},p=[],b={name:"second",props:["tableData"],data:function(){return{fixed:{chapter:{chapterName:"123",chapterLabel:"",chapterId:"",courseId:""},section:[{sectionId:"",sectionName:"123",videoPath:"",videoSize:"",videoName:"",sectionLabel:"",courseId:"",chapterId:""}]},rules:{chapterName:[{required:!0,message:"请输入章名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 ",trigger:"blur"}],sectionName:[{required:!0,message:"请输入小节称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 ",trigger:"blur"}],videoSize:[{required:!0,message:"请选择视频",trigger:"blur"}]},videoList:{}}},methods:{getVideoPath:function(e,t,r){this.tableData[t].section[r].videoPath=e},changeVideo:function(e,t,r,a){this.tableData[r].section[a].videoSize=e.size,this.tableData[r].section[a].sectionLabel=r+"-"+a,this.tableData[r].section[a].videoName=e.name,this.tableData[r].chapter.chapterLabel=r,e.index=r,e.id=a;var i=10+r+"-"+(10+a);this.videoList[i]=e},submitForm:function(){var e=!0;return this.$refs.ruleFormSecond.forEach((function(t){t.validate((function(t){t||(e=!1)}))})),this.$refs.ruleFormChild.forEach((function(t){t.validate((function(t){t||(e=!1)}))})),e?this.$emit("videoList",this.videoList,this.tableData):this.$message.error("请填写完整"),e}},mounted:function(){},create:function(){}},g=b,v=(r("2daa"),Object(d["a"])(g,f,p,!1,null,"7c624508",null)),x=v.exports,w=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"box"}},e._l(e.list,(function(t,a){return r("div",{key:a},[r("el-upload",{ref:"upload",refInFor:!0,staticClass:"avatar-uploader",attrs:{action:e.nodeUrl,"show-file-list":!0,"auto-upload":!0,"on-success":e.success,"before-upload":e.beforeAvatarUpload,"list-type":"picture",disabled:!0,"file-list":[t]}},[r("i",{staticClass:"el-icon-folder-opened  el-upload__tip",staticStyle:{"font-size":"50px","margin-left":"20px",position:"relative",top:"80px","z-index":"100"}})])],1)})),0)},I=[],F={props:["list","tableData","courseId"],data:function(){return{uploadId:0,message:"",uploadSuccess:!1,nodeUrl:this.$nodeUrl+"video/createVideo"}},methods:{submit:function(e){this.$refs.upload[this.uploadId].submit()},success:function(e,t,r){this.tableData[t.index].section[t.id].videoPath=e,this.createSec(),this.list.length-1>this.uploadId?this.submit(this.uploadId++):(this.createChapter(),this.uploadSuccess=!0)},beforeAvatarUpload:function(e){return!0},createSec:function(){var e=this;this.tableData.forEach((function(t,r,a){t.section.forEach((function(t,a){e.createSection(r,a)}))}))},createSection:function(e,t){var r=this.tableData[e].section[t];r.courseId=this.courseId,r.chapterId=this.courseId+""+(100+e),r.sectionId=this.courseId+""+(100+e)+(100+t),console.log(this.courseId+""+(100+e)+(100+t)),console.log(r),this.$api.createSection(r,(function(e){}))},createChapter:function(){var e=this;this.tableData.forEach((function(t,r){var a=t.chapter;a.courseId=e.courseId,a.chapterId=e.courseId+""+(100+r),e.$api.createChapter(a,(function(e){}))}))}},mounted:function(){this.submit(0),this.message=this.$message({type:"warning",message:"请上传成功前不要关闭页面",duration:0})},watch:{uploadSuccess:function(){this.message.close()}},beforeRouteLeave:function(e,t,r){this.uploadSuccess?(this.message.close(),r()):this.$notify({title:"警告",message:"还未上传完成",type:"warning"})}},C=F,y=(r("c355"),Object(d["a"])(C,w,I,!1,null,"37edacae",null)),S=y.exports,$={name:"upload",components:{first:h,second:x,third:S},props:["courseList"],data:function(){return{active:0,list:[],tableData:[],courseId:this.courseList.courseId,chapterList:[],sectionList:[]}},methods:{backStep:function(){this.active--},nextStep:function(){this.$refs.first.submitForm()&&this.active++},createStep:function(){var e=this,t={courseId:this.courseId},r=!0;this.$api.deleteCourse(t,(function(a){a&&(e.$api.deleteSection(t,(function(e){e||(r=!1)})),e.$api.deleteChapter(t,(function(e){e||(r=!1)})),r&&e.$refs.second.submitForm())}))},videoList:function(e,t){console.log(e),console.log(t);var r=[],a=[];for(var i in e)r.push(i);for(var s=0,o=r;s<o.length;s++){var n=o[s];a.push(e[n])}this.$refs.first.createCourse(this.courseId),this.list=a,this.tableData=t,this.active++},getChapter:function(){var e=this,t=[];this.$api.getChapter({courseId:this.courseList.courseId},(function(r){e.getSection(),r.forEach((function(e,a){t.push({chapter:{},section:[]});var i=[];i=r.filter((function(t,r){return e.chapterLabel===a+""})),t[a].chapter=i[a]})),e.tableData=t}))},getSection:function(){var e=this,t=[];this.$api.getSection({courseId:this.courseList.courseId},(function(r){e.tableData.forEach((function(a,i){t=r.filter((function(e,t){return e.sectionLabel.split("")[0]===i+""})),e.tableData[i].section=t}))}))}},mounted:function(){this.getChapter()},created:function(){}},_=$,N=(r("34f7"),Object(d["a"])(_,s,o,!1,null,"378639ca",null)),D=N.exports,k=r("1c46"),L={name:"manageVideo",props:["tableData","admin"],data:function(){return{change:!1,courseList:{}}},methods:{cryptoJs:function(e){var t=Date.now(),r=this.$allFun.getTime(t)+new Date(t).getHours()+parseInt((new Date(t).getMinutes()/3).toFixed(0));return k.createHmac("sha256",r).update(e).digest("hex")},selectCourse_openId:function(){var e=this;this.$api.selectCourse_openId({create:this.$userInfo.openId},(function(t){e.tableData=t}))},updateCourse:function(e){this.courseList=e.row,this.change=!0},deleteCourse:function(e){var t=this,r={courseId:e.row.courseId};this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$api.deleteCourse(r,(function(a){a&&(t.tableData.splice(e.$index,1),t.$api.deleteSection(r,(function(e){})),t.$api.deleteChapter(r,(function(e){})))})),t.$message({type:"success",message:"删除成功!"})})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))}},mounted:function(){},created:function(){this.tableData||this.selectCourse_openId()},components:{upload:D}},z=L,P=(r("9af8"),Object(d["a"])(z,a,i,!1,null,"0687b45a",null));t["default"]=P.exports},"1ed2":function(e,t,r){},"2daa":function(e,t,r){"use strict";var a=r("854a"),i=r.n(a);i.a},3204:function(e,t,r){},"34f7":function(e,t,r){"use strict";var a=r("1ed2"),i=r.n(a);i.a},"7b07":function(e,t,r){"use strict";var a=r("d040"),i=r.n(a);i.a},"854a":function(e,t,r){},"9af8":function(e,t,r){"use strict";var a=r("3204"),i=r.n(a);i.a},a434:function(e,t,r){"use strict";var a=r("23e7"),i=r("23cb"),s=r("a691"),o=r("50c4"),n=r("7b0b"),c=r("65f0"),u=r("8418"),l=r("1dde"),d=Math.max,m=Math.min,h=9007199254740991,f="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!l("splice")},{splice:function(e,t){var r,a,l,p,b,g,v=n(this),x=o(v.length),w=i(e,x),I=arguments.length;if(0===I?r=a=0:1===I?(r=0,a=x-w):(r=I-2,a=m(d(s(t),0),x-w)),x+r-a>h)throw TypeError(f);for(l=c(v,a),p=0;p<a;p++)b=w+p,b in v&&u(l,p,v[b]);if(l.length=a,r<a){for(p=w;p<x-a;p++)b=p+a,g=p+r,b in v?v[g]=v[b]:delete v[g];for(p=x;p>x-a+r;p--)delete v[p-1]}else if(r>a)for(p=x-a;p>w;p--)b=p+a-1,g=p+r-1,b in v?v[g]=v[b]:delete v[g];for(p=0;p<r;p++)v[p+w]=arguments[p+2];return v.length=x-a+r,l}})},b0c0:function(e,t,r){var a=r("83ab"),i=r("9bf2").f,s=Function.prototype,o=s.toString,n=/^\s*function ([^ (]*)/,c="name";!a||c in s||i(s,c,{configurable:!0,get:function(){try{return o.call(this).match(n)[1]}catch(e){return""}}})},c355:function(e,t,r){"use strict";var a=r("e526"),i=r.n(a);i.a},d040:function(e,t,r){},e526:function(e,t,r){}}]);
//# sourceMappingURL=chunk-3cc8dbde.161ae2be.js.map